# AT-008: lostRevenueSummary (MVP Slice)

## Ziel
HTTP-Endpoint `lostRevenueSummary` berechnet den „Lost Revenue“ je `tenantId` aus den in `events` gespeicherten Mock-Events.
Logik (v1):
- berücksichtige nur `type = "cart_abandon"`
- filtere nach `tenantId` (Pflicht)
- summe `amount` (>= 0) über alle passenden Dokumente

Response (200):
```json
{ "tenantId": "t1", "lostRevenue": 123.45, "ts": "<ISO-8601>" }
Scope
In-Scope: functions/index.js (neuer Endpoint)

Out-of-Scope: Orders/Refunds, echte Attribution, Persistenz der Summen, Auth, Indexe, CI-Erweiterung

Inputs
Query-Param: tenantId (string, required)

Output
HTTP 200 JSON: { tenantId, lostRevenue, ts } (lostRevenue = number, 2 Nachkommastellen)

HTTP 400 bei fehlendem tenantId: { "error": "bad_request" }

Tests
Voraussetzung: Mind. ein Event vorhanden (z. B. per eventWriteMock mit tenantId: "t1", type: "cart_abandon").

Emulator: npm run emu --prefix functions

Happy Path:

nginx
Code kopieren
curl -s "http://127.0.0.1:5001/recovery-engine/europe-west1/lostRevenueSummary?tenantId=t1"
Erwartet: 200, JSON enthält tenantId:"t1", lostRevenue >= 0 (number), ts ISO-8601.

Bad Request:

swift
Code kopieren
curl -s -o - -w "\n%{http_code}\n" "http://127.0.0.1:5001/recovery-engine/europe-west1/lostRevenueSummary"
Erwartet: 400 + { "error": "bad_request" }.

Definition of Done
Bestehende Endpoints weiter funktionsfähig.

Nur functions/index.js geändert.

Node 22, Region europe-west1.

Lokale Tests grün, CI bleibt grün.
