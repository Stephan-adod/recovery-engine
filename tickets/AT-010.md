# AT-010 (MVP): recoveryEmailMock

## Ziel
HTTP-Endpoint `recoveryEmailMock` validiert eine minimale Payload und „sendet“ eine Recovery-Mail als Mock:
- schreibt einen Eintrag in Firestore-Collection `emails` (`status: "queued"`)
- liefert 202 mit Echo der Daten + `queuedAt` (ISO-8601)

## Scope
- In-Scope: `functions/index.js` (neuer Endpoint)
- Out-of-Scope: echte Postmark-Calls, Secrets, Templating, Auth

## Inputs (POST JSON, Content-Type: application/json)
- `tenantId` (string, required)
- `to` (string, required; rudimentär prüfen: enthält "@")
- `template` (string, required; z. B. `"recovery_v1"`)
- `data` (object, optional; z. B. `{ firstName: "…" }`)

## Persistenz
- Firestore (Emulator): `emails`-Dokument mit Feldern
  ```json
  {
    "tenantId": "...",
    "to": "user@example.com",
    "template": "recovery_v1",
    "data": { ... },
    "status": "queued",
    "queuedAt": "<ISO-8601>"
  }
Output
202 Accepted:

json
Code kopieren
{
  "ok": true,
  "status": "queued",
  "tenantId": "...",
  "to": "user@example.com",
  "template": "recovery_v1",
  "queuedAt": "<ISO-8601>"
}
400 Bad Request bei fehlenden/invaliden Feldern:

json
Code kopieren
{ "error": "bad_request", "details": [ "..."] }
Tests
Emulator: npm run emu --prefix functions

Happy Path:

swift
Code kopieren
curl -s -X POST "http://127.0.0.1:5001/recovery-engine/europe-west1/recoveryEmailMock" ^
  -H "Content-Type: application/json" ^
  -d "{\"tenantId\":\"t1\",\"to\":\"user@example.com\",\"template\":\"recovery_v1\",\"data\":{\"firstName\":\"A.\"}}"
Erwartet: HTTP 202, JSON ok:true, status:"queued", queuedAt ISO.
Firestore-UI: neues emails-Dokument mit obigen Feldern.

Bad Request:

swift
Code kopieren
curl -s -o - -w "\n%{http_code}\n" -X POST "http://127.0.0.1:5001/recovery-engine/europe-west1/recoveryEmailMock" ^
  -H "Content-Type: application/json" -d "{}"
Erwartet: 400 + Fehlermeldung.

Definition of Done
Bestehende Endpoints bleiben funktionsfähig.

Nur functions/index.js geändert.

Node 22, Region europe-west1.

Lokale Tests grün, CI bleibt grün.

Ticket ist als MVP Track gekennzeichnet.
