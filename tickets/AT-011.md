# AT-011 (MVP): recoveryStatus API

## Ziel
HTTP-Endpoint `recoveryStatus` liefert pro `tenantId` eine kompakte Status-Zusammenfassung für das MVP:
- Lost Revenue Summe (nur `type="cart_abandon"` aus `events`)
- Anzahl der „queued“ Recovery-Mails (`emails`)
- Timestamp

## Scope
- In-Scope: `functions/index.js` (neuer Endpoint)
- Out-of-Scope: Auth, echte Sending-Pipeline, Indexe, Deploy, Pagination

## Inputs
- Query-Param: `tenantId` (string, **required**)

## Output
**200 OK**
```json
{
  "tenantId": "t1",
  "lostRevenue": 123.45,
  "emailsQueued": 2,
  "ts": "<ISO-8601>"
}
lostRevenue: Summe amount (>=0) aus events mit tenantId und type="cart_abandon"

emailsQueued: Anzahl Docs in emails mit tenantId und status="queued"

400 Bad Request

json
Code kopieren
{ "error": "bad_request" }
Tests
Voraussetzung: Mind. ein events-Dokument mit type="cart_abandon" und passendem tenantId, sowie mind. eine emails-Zeile mit status="queued".

Emulator: npm run emu --prefix functions

Happy Path:

nginx
Code kopieren
curl -s "http://127.0.0.1:5001/recovery-engine/europe-west1/recoveryStatus?tenantId=t1"
Erwartet: 200, JSON enthält tenantId, lostRevenue (number, >=0, max. 2 Nachkommastellen), emailsQueued (number >=0), ts ISO-8601.

Bad Request:

swift
Code kopieren
curl -s -o - -w "\n%{http_code}\n" "http://127.0.0.1:5001/recovery-engine/europe-west1/recoveryStatus"
Erwartet: 400 + { "error": "bad_request" }.

Definition of Done
Bestehende Endpoints bleiben funktionsfähig.

Nur functions/index.js geändert.

Node 22, Region europe-west1.

Lokale Tests grün, CI bleibt grün.

Ticket ist als MVP Track gekennzeichnet.
